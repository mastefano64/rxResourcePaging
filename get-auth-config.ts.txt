import { inject, Injector } from '@angular/core';

import { ConfigService } from '../service/config.service';
import { AuthService } from '../service/auth.service';
import { Configuration } from '../configuration';
import { AuthStatus } from '../authstatus';
import { DataLogin, Moduli, Progetti } from '../data-login';

export interface CurrentAuthAndConfig {
  configuration: Configuration,
  saveAuthStatus: () => void,
  isHeightUser: () => boolean,
  status: AuthStatus,
  datalogin: DataLogin,
  progetti: Progetti[],
  moduli: Moduli[],
}

export function getAuthAndConfig(): CurrentAuthAndConfig {
  // const myinjector = inject(Injector);
  const authservice = inject(AuthService);
  const configservice = inject(ConfigService);

  const authandconfig = {
    configuration: configservice.getConfiguration(),
    saveAuthStatus: authservice.saveAuthStatus.bind(authservice),
    status: authservice.status,
    datalogin: authservice.status.dataLogin,
    progetti: authservice.status.dataLogin.progetti,
    moduli: authservice.status.dataLogin.moduli,

    isHeightUser(): boolean {
      let valret = false;
      const role = this.status.role.toLowerCase();
      if (role === 'amministratore' || role === 'validatore' || role === 'tecnico') {
        valret = true;
      }
      return valret;
    }

  }

	return authandconfig;
}
